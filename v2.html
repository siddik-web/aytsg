<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced YouTube Script Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #ff0000;
            --secondary: #282828;
            --dark: #181818;
            --light: #f1f1f1;
            --gray: #aaaaaa;
            --success: #4CAF50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196F3;
            --purple: #9c27b0;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        header p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr 300px;
            gap: 30px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
            
            .history-section {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .input-section, .output-section, .history-section {
            background: #202020;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary);
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 5px;
            border: 1px solid #333;
            background: #181818;
            color: var(--light);
            font-size: 1rem;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .api-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .api-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #333;
        }

        .api-option:hover {
            border-color: var(--gray);
        }

        .api-option.active {
            border-color: var(--primary);
            background: rgba(255, 0, 0, 0.1);
        }

        .api-option i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #333;
            color: white;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #0b7dda;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-purple {
            background: var(--purple);
            color: white;
        }

        .btn-purple:hover {
            background: #7b1fa2;
        }

        .btn-block {
            width: 100%;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .output-content {
            min-height: 300px;
            background: #181818;
            border-radius: 5px;
            padding: 20px;
            border: 1px solid #333;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 500px;
            font-family: 'Courier New', monospace;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.loading {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid var(--info);
            color: var(--info);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature-card {
            background: #202020;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .feature-card h3 {
            margin-bottom: 10px;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            color: var(--gray);
            border-top: 1px solid #333;
        }

        .api-key-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .api-key-section h3 {
            margin-bottom: 10px;
        }

        .key-input {
            display: flex;
            gap: 10px;
        }

        .key-input input {
            flex: 1;
        }

        .key-input button {
            padding: 12px 15px;
        }

        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .model-option {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border-radius: 5px;
            background: #181818;
            text-align: center;
            cursor: pointer;
            border: 1px solid #333;
            font-size: 0.9rem;
        }

        .model-option.active {
            border-color: var(--primary);
            background: rgba(255, 0, 0, 0.1);
        }

        .advanced-options {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }

        .advanced-options h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .history-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            transition: background 0.2s;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .history-meta {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            justify-content: space-between;
        }

        .history-api {
            background: rgba(255, 0, 0, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
        }

        .empty-history {
            text-align: center;
            color: var(--gray);
            padding: 30px;
        }

        .script-stats {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            border-radius: 5px;
        }

        .token-counter {
            text-align: right;
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 15px;
            background: #181818;
            border: 1px solid #333;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }

        .tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .export-btn {
            flex: 1;
            text-align: center;
        }

        .edit-mode {
            border: 2px solid var(--info);
        }

        .preview-content {
            background: #181818;
            border-radius: 5px;
            padding: 20px;
            border: 1px solid #333;
            min-height: 300px;
            font-family: 'Courier New', monospace;
        }

        .script-structure-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .structure-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
        }

        .structure-item.active {
            border-color: var(--primary);
            background: rgba(255, 0, 0, 0.1);
        }

        .structure-item h4 {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .structure-item p {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .model-category {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .model-category:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .model-category h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }

        .premium-badge {
            background: var(--purple);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fab fa-youtube"></i> Advanced YouTube Script Generator</h1>
            <p>Create engaging video scripts with AI assistance and save your history</p>
        </header>

        <div class="status" id="status"></div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">
                    <span><i class="fas fa-edit"></i> Script Configuration</span>
                </h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="basic">Basic</div>
                    <div class="tab" data-tab="advanced">Advanced</div>
                    <div class="tab" data-tab="api">API Settings</div>
                </div>

                <div class="tab-content active" id="basic-tab">
                    <div class="api-selector">
                        <div class="api-option active" data-api="openai">
                            <i class="fab fa-openai"></i>
                            <h3>OpenAI</h3>
                            <p>GPT Models</p>
                        </div>
                        <div class="api-option" data-api="gemini">
                            <i class="fas fa-robot"></i>
                            <h3>Gemini</h3>
                            <p>Google AI</p>
                        </div>
                        <div class="api-option" data-api="ollama">
                            <i class="fas fa-brain"></i>
                            <h3>Ollama</h3>
                            <p>Local Models</p>
                        </div>
                    </div>

                    <div class="model-selector" id="openai-models">
                        <div class="model-category">
                            <h4>GPT-4 Series</h4>
                            <div class="model-option active" data-model="gpt-4-turbo">GPT-4 Turbo</div>
                            <div class="model-option" data-model="gpt-4">GPT-4</div>
                            <div class="model-option" data-model="gpt-4-32k">GPT-4 32K <span class="premium-badge">Premium</span></div>
                        </div>
                        <div class="model-category">
                            <h4>GPT-3.5 Series</h4>
                            <div class="model-option" data-model="gpt-3.5-turbo">GPT-3.5 Turbo</div>
                            <div class="model-option" data-model="gpt-3.5-turbo-16k">GPT-3.5 Turbo 16K</div>
                        </div>
                    </div>

                    <div class="model-selector" id="gemini-models" style="display: none;">
                        <div class="model-category">
                            <h4>Gemini Pro Series</h4>
                            <div class="model-option active" data-model="gemini-2.0-flash">Gemini 2.0 Flash</div>
                            <div class="model-option" data-model="gemini-1.5-pro-latest">Gemini 1.5 Pro</div>
                        </div>
                        <div class="model-category">
                            <h4>Gemini Ultra</h4>
                            <div class="model-option" data-model="gemini-ultra">Gemini Ultra <span class="premium-badge">Premium</span></div>
                        </div>
                    </div>

                    <div class="model-selector" id="ollama-models" style="display: none;">
                        <div class="model-category">
                            <h4>Ollama Local Models</h4>
                            <div class="model-option active" data-model="llama2">llama2</div>
                            <div class="model-option" data-model="mistral">mistral</div>
                            <div class="model-option" data-model="codellama">codellama</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="topic">Video Topic *</label>
                        <input type="text" id="topic" placeholder="Enter your video topic...">
                    </div>

                    <div class="form-group">
                        <label for="audience">Target Audience</label>
                        <input type="text" id="audience" placeholder="Who is your target audience?">
                    </div>

                    <div class="form-group">
                        <label for="tone">Tone of Voice</label>
                        <select id="tone">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="humorous">Humorous</option>
                            <option value="educational">Educational</option>
                            <option value="entertaining">Entertaining</option>
                            <option value="inspirational">Inspirational</option>
                            <option value="authoritative">Authoritative</option>
                            <option value="conversational">Conversational</option>
                            <option value="storytelling">Storytelling</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="length">Video Length (minutes)</label>
                        <input type="number" id="length" min="1" max="120" value="5">
                    </div>
                </div>

                <div class="tab-content" id="advanced-tab">
                    <div class="advanced-options">
                        <h3><i class="fas fa-cogs"></i> Script Structure</h3>
                        <div class="script-structure-grid">
                            <div class="structure-item active" data-structure="intro">
                                <h4>Intro Hook</h4>
                                <p>Capture attention</p>
                            </div>
                            <div class="structure-item active" data-structure="problem">
                                <h4>Problem Statement</h4>
                                <p>Identify pain points</p>
                            </div>
                            <div class="structure-item active" data-structure="solution">
                                <h4>Solution</h4>
                                <p>Present your answer</p>
                            </div>
                            <div class="structure-item active" data-structure="benefits">
                                <h4>Benefits</h4>
                                <p>Value proposition</p>
                            </div>
                            <div class="structure-item active" data-structure="examples">
                                <h4>Examples</h4>
                                <p>Real-world cases</p>
                            </div>
                            <div class="structure-item active" data-structure="steps">
                                <h4>Action Steps</h4>
                                <p>Implementation guide</p>
                            </div>
                            <div class="structure-item active" data-structure="mistakes">
                                <h4>Common Mistakes</h4>
                                <p>What to avoid</p>
                            </div>
                            <div class="structure-item active" data-structure="tools">
                                <h4>Tools/Resources</h4>
                                <p>Helpful materials</p>
                            </div>
                            <div class="structure-item active" data-structure="summary">
                                <h4>Summary</h4>
                                <p>Key takeaways</p>
                            </div>
                            <div class="structure-item active" data-structure="cta">
                                <h4>Call to Action</h4>
                                <p>Next steps</p>
                            </div>
                            <div class="structure-item" data-structure="faq">
                                <h4>FAQ</h4>
                                <p>Common questions</p>
                            </div>
                            <div class="structure-item" data-structure="visuals">
                                <h4>Visual Cues</h4>
                                <p>On-screen elements</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="additional">Additional Instructions</label>
                        <textarea id="additional" placeholder="Any specific points you want to include?"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="keywords">SEO Keywords (comma separated)</label>
                        <input type="text" id="keywords" placeholder="keyword1, keyword2, keyword3">
                    </div>
                </div>

                <div class="tab-content" id="api-tab">
                    <div class="api-key-section">
                        <h3><i class="fas fa-key"></i> OpenAI API Key</h3>
                        <div class="key-input">
                            <input type="password" id="openai-key" placeholder="Enter your OpenAI API key...">
                            <button class="btn btn-secondary" id="save-openai-key">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                    </div>

                    <div class="api-key-section">
                        <h3><i class="fas fa-key"></i> Google AI Studio Key</h3>
                        <div class="key-input">
                            <input type="password" id="gemini-key" placeholder="Enter your Google AI Studio key...">
                            <button class="btn btn-secondary" id="save-gemini-key">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                    </div>

                    <div class="api-key-section">
                        <h3><i class="fas fa-key"></i> Ollama API Base URL</h3>
                        <div class="key-input">
                            <input type="text" id="ollama-base-url" placeholder="e.g., http://localhost:11434">
                            <button class="btn btn-secondary" id="save-ollama-url">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="temperature">Creativity Level (0-2)</label>
                        <input type="range" id="temperature" min="0" max="2" step="0.1" value="1">
                        <div class="token-counter">
                            <span id="temp-value">1.0</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="max-tokens">Max Tokens</label>
                        <input type="number" id="max-tokens" min="100" max="32768" value="3000">
                    </div>
                </div>

                <button class="btn btn-primary btn-block" id="generate-btn">
                    <i class="fas fa-magic"></i> Generate Script
                </button>
            </div>

            <div class="output-section">
                <h2 class="section-title">
                    <span><i class="fas fa-file-alt"></i> Generated Script</span>
                    <div class="section-actions">
                        <button class="btn btn-sm btn-secondary" id="save-script">
                            <i class="fas fa-save"></i>
                        </button>
                    </div>
                </h2>
                
                <div class="script-stats">
                    <div class="stat-item">
                        <i class="fas fa-clock"></i> <span id="script-length">0</span> min
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-font"></i> <span id="word-count">0</span> words
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-hashtag"></i> <span id="char-count">0</span> chars
                    </div>
                </div>

                <div class="output-content" id="script-output">Your generated script will appear here...</div>
                
                <div class="token-counter">
                    Estimated tokens: <span id="token-count">0</span>
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" id="copy-btn">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="btn btn-secondary" id="regenerate-btn">
                        <i class="fas fa-redo"></i> Regenerate
                    </button>
                    <button class="btn btn-info" id="edit-btn">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                </div>

                <div class="export-options">
                    <button class="btn btn-secondary export-btn" id="download-txt">
                        <i class="fas fa-file-alt"></i> TXT
                    </button>
                    <button class="btn btn-secondary export-btn" id="download-doc">
                        <i class="fas fa-file-word"></i> DOC
                    </button>
                    <button class="btn btn-secondary export-btn" id="download-pdf">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                </div>
            </div>

            <div class="history-section">
                <h2 class="section-title">
                    <span><i class="fas fa-history"></i> Script History</span>
                    <div class="section-actions">
                        <button class="btn btn-sm btn-danger" id="clear-history">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </h2>
                
                <div class="history-list" id="history-list">
                    <div class="empty-history">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>No scripts generated yet</p>
                        <p>Your history will appear here</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="features">
            <div class="feature-card">
                <i class="fas fa-bolt"></i>
                <h3>Fast Generation</h3>
                <p>Create scripts in seconds with powerful AI models</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-history"></i>
                <h3>History Saving</h3>
                <p>Save and revisit your generated scripts anytime</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-sliders-h"></i>
                <h3>Advanced Controls</h3>
                <p>Fine-tune creativity, structure, and output length</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-file-export"></i>
                <h3>Multiple Exports</h3>
                <p>Download scripts in TXT, DOC, and PDF formats</p>
            </div>
        </div>

        <footer>
            <p>Advanced YouTube Script Generator &copy; 2025 | Create engaging content with AI assistance</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const apiOptions = document.querySelectorAll('.api-option');
        const openaiModels = document.getElementById('openai-models');
        const geminiModels = document.getElementById('gemini-models');
        const ollamaModels = document.getElementById('ollama-models');
        const modelOptions = document.querySelectorAll('.model-selector .model-option');
        const structureItems = document.querySelectorAll('.structure-item');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const generateBtn = document.getElementById('generate-btn');
        const copyBtn = document.getElementById('copy-btn');
        const downloadTxtBtn = document.getElementById('download-txt');
        const downloadDocBtn = document.getElementById('download-doc');
        const downloadPdfBtn = document.getElementById('download-pdf');
        const saveScriptBtn = document.getElementById('save-script');
        const saveOpenaiKeyBtn = document.getElementById('save-openai-key');
        const saveGeminiKeyBtn = document.getElementById('save-gemini-key');
        const saveOllamaUrlBtn = document.getElementById('save-ollama-url');
        const clearHistoryBtn = document.getElementById('clear-history');
        const regenerateBtn = document.getElementById('regenerate-btn');
        const editBtn = document.getElementById('edit-btn');
        const statusEl = document.getElementById('status');
        const scriptOutput = document.getElementById('script-output');
        const historyList = document.getElementById('history-list');
        const temperatureSlider = document.getElementById('temperature');
        const tempValue = document.getElementById('temp-value');

        // Current selections
        let currentAPI = 'ollama';
        let currentModel = 'llama2';
        let lastGeneratedScript = null;
        let lastGenerationParams = null;

        // Storage keys
        const OPENAI_KEY_STORAGE = 'youtube_script_openai_key';
        const GEMINI_KEY_STORAGE = 'youtube_script_gemini_key';
        const HISTORY_STORAGE = 'youtube_script_history';
        const OLLAMA_BASE_URL_STORAGE = 'youtube_script_ollama_base_url';

        // Event Listeners
        apiOptions.forEach(option => {
            option.addEventListener('click', () => {
                apiOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentAPI = option.dataset.api;
                
                // Show/hide model selectors
                // Hide all model selectors first
                openaiModels.style.display = 'none';
                geminiModels.style.display = 'none';
                ollamaModels.style.display = 'none';

                // Show the relevant model selector and set currentModel
                if (currentAPI === 'openai') {
                    openaiModels.style.display = 'block';
                    const activeOpenAIModel = document.querySelector('#openai-models .model-option.active');
                    currentModel = activeOpenAIModel ? activeOpenAIModel.dataset.model : 'gpt-4'; // Default to gpt-4 or handle as needed
                } else if (currentAPI === 'gemini') {
                    geminiModels.style.display = 'block';
                    const activeGeminiModel = document.querySelector('#gemini-models .model-option.active');
                    currentModel = activeGeminiModel ? activeGeminiModel.dataset.model : 'gemini-pro'; // Default to gemini-pro or handle as needed
                } else if (currentAPI === 'ollama') {
                    ollamaModels.style.display = 'block';
                    const activeOllamaModel = document.querySelector('#ollama-models .model-option.active');
                    currentModel = activeOllamaModel ? activeOllamaModel.dataset.model : ''; // Default to empty or first available Ollama model
                }
            });
        });

        modelOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Remove active class from siblings
                let parent = option.parentElement;
                while (parent && !parent.classList.contains('model-selector')) {
                    parent = parent.parentElement;
                }
                if (parent) {
                    parent.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('active'));
                }
                option.classList.add('active');
                currentModel = option.dataset.model;
            });
        });

        structureItems.forEach(item => {
            item.addEventListener('click', () => {
                item.classList.toggle('active');
            });
        });

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(tc => tc.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });

        temperatureSlider.addEventListener('input', () => {
            tempValue.textContent = temperatureSlider.value;
        });

        generateBtn.addEventListener('click', generateScript);
        copyBtn.addEventListener('click', copyScript);
        downloadTxtBtn.addEventListener('click', () => downloadScript('txt'));
        downloadDocBtn.addEventListener('click', () => downloadScript('doc'));
        downloadPdfBtn.addEventListener('click', () => downloadScript('pdf'));
        saveScriptBtn.addEventListener('click', saveCurrentScript);
        saveOpenaiKeyBtn.addEventListener('click', () => saveApiKey('openai'));
        saveGeminiKeyBtn.addEventListener('click', () => saveApiKey('gemini'));
        saveOllamaUrlBtn.addEventListener('click', () => saveApiKey('ollama'));
        clearHistoryBtn.addEventListener('click', clearHistory);
        regenerateBtn.addEventListener('click', regenerateScript);
        editBtn.addEventListener('click', enableEditMode);

        // Load saved data
        window.addEventListener('DOMContentLoaded', () => {
            loadApiKeys();
            loadHistory();
            updateScriptStats(scriptOutput.textContent);
            tempValue.textContent = temperatureSlider.value;
            fetchOllamaModels(); // Load Ollama models on page load
        });

        // Load API Keys
        function loadApiKeys() {
            const openaiKey = localStorage.getItem(OPENAI_KEY_STORAGE);
            const geminiKey = localStorage.getItem(GEMINI_KEY_STORAGE);
            const ollamaBaseUrl = localStorage.getItem(OLLAMA_BASE_URL_STORAGE);
            
            if (openaiKey) {
                document.getElementById('openai-key').value = openaiKey;
            }
            
            if (geminiKey) {
                document.getElementById('gemini-key').value = geminiKey;
            }

            if (ollamaBaseUrl) {
                document.getElementById('ollama-base-url').value = ollamaBaseUrl;
            }
        }

        // Save API Key
        function saveApiKey(apiType) {
            const keyInput = document.getElementById(`${apiType}-key`) || document.getElementById(`${apiType}-base-url`);
            const key = keyInput.value;
            
            if (key) {
                let storageKey;
                if (apiType === 'openai') {
                    storageKey = OPENAI_KEY_STORAGE;
                } else if (apiType === 'gemini') {
                    storageKey = GEMINI_KEY_STORAGE;
                } else if (apiType === 'ollama') {
                    storageKey = OLLAMA_BASE_URL_STORAGE;
                }
                localStorage.setItem(storageKey, key);
                showStatus(`${apiType.toUpperCase()} ${apiType === 'ollama' ? 'Base URL' : 'API key'} saved successfully!`, 'success');
            } else {
                showStatus(`Please enter a valid ${apiType.toUpperCase()} ${apiType === 'ollama' ? 'Base URL' : 'API key'}`, 'error');
            }
        }

        // Load History
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem(HISTORY_STORAGE) || '[]');
            renderHistory(history);
        }

        // Render History
        function renderHistory(history) {
            if (history.length === 0) {
                historyList.innerHTML = `
                    

                        
                        

No scripts generated yet


                        

Your history will appear here


                    

                `;
                return;
            }

            historyList.innerHTML = '';
            history.slice().reverse().forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    

                        ${item.topic || 'Untitled Script'}</span>
                        <span class="history-api">${item.api.toUpperCase()}
                    

                    

                        ${new Date(item.timestamp).toLocaleDateString()}</span>
                        <span>${Math.round(item.script.length / 1000)}s read
                    

                `;
                
                historyItem.addEventListener('click', () => loadHistoryItem(item));
                historyList.appendChild(historyItem);
            });
        }

        // Load History Item
        function loadHistoryItem(item) {
            scriptOutput.textContent = item.script;
            updateScriptStats(item.script);
            
            // Update form fields
            document.getElementById('topic').value = item.topic || '';
            document.getElementById('audience').value = item.audience || '';
            document.getElementById('tone').value = item.tone || 'professional';
            document.getElementById('length').value = item.length || 5;
            document.getElementById('additional').value = item.additional || '';
            
            showStatus('Script loaded from history', 'success');
        }

        // Generate Script
        async function generateScript() {
            const topic = document.getElementById('topic').value;
            const audience = document.getElementById('audience').value;
            const tone = document.getElementById('tone').value;
            const length = document.getElementById('length').value;
            const additional = document.getElementById('additional').value;
            const keywords = document.getElementById('keywords').value;
            const temperature = parseFloat(document.getElementById('temperature').value);
            const maxTokens = parseInt(document.getElementById('max-tokens').value);
            
            const openaiKey = document.getElementById('openai-key').value;
            const geminiKey = document.getElementById('gemini-key').value;
            const ollamaBaseUrl = document.getElementById('ollama-base-url').value;

            // Validation
            if (!topic) {
                showStatus('Please enter a video topic', 'error');
                return;
            }

            if (currentAPI === 'openai' && !openaiKey) {
                showStatus('Please enter your OpenAI API key', 'error');
                return;
            }

            if (currentAPI === 'gemini' && !geminiKey) {
                showStatus('Please enter your Google AI Studio key', 'error');
                return;
            }

            if (currentAPI === 'ollama' && !ollamaBaseUrl) {
                showStatus('Please enter your Ollama Base URL', 'error');
                return;
            }

            // Get active structure items
            const activeStructures = [];
            structureItems.forEach(item => {
                if (item.classList.contains('active')) {
                    activeStructures.push(item.dataset.structure);
                }
            });

            // Store parameters for regeneration
            lastGenerationParams = {
                topic, audience, tone, length, additional, keywords, temperature, maxTokens, activeStructures
            };

            // Show loading status
            showStatus(`Generating script with ${currentAPI === 'openai' ? 'OpenAI' : (currentAPI === 'gemini' ? 'Gemini' : 'Ollama')} (${currentModel})...`, 'loading');

            try {
                let script;
                if (currentAPI === 'openai') {
                    script = await generateWithOpenAI(topic, audience, tone, length, additional, keywords, temperature, maxTokens, activeStructures, openaiKey, currentModel);
                } else if (currentAPI === 'gemini') {
                    script = await generateWithGemini(topic, audience, tone, length, additional, keywords, temperature, maxTokens, activeStructures, geminiKey, currentModel);
                } else if (currentAPI === 'ollama') {
                    script = await generateWithOllama(topic, audience, tone, length, additional, keywords, temperature, maxTokens, activeStructures, ollamaBaseUrl, currentModel);
                }
                
                scriptOutput.textContent = script;
                updateScriptStats(script);
                
                // Store last generated script
                lastGeneratedScript = script;
                
                showStatus('Script generated successfully!', 'success');
            } catch (error) {
                console.error('Error:', error);
                showStatus(`Error: ${error.message}`, 'error');
            }
        }

        // Generate with Ollama
        async function generateWithOllama(topic, audience, tone, length, additional, keywords, temperature, maxTokens, activeStructures, ollamaBaseUrl, model) {
            try {
                const prompt = `Generate a YouTube video script based on the following:
Topic: ${topic}
Audience: ${audience}
Tone: ${tone}
Length: ${length} minutes
Additional Instructions: ${additional}
Keywords: ${keywords}

${activeStructures.length > 0 ? 'Include the following structures: ' + activeStructures.join(', ') + '\n\n' : ''}

Script:`;

                const response = await fetch('http://localhost:3001/api/ollama/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: model,
                        prompt: prompt,
                        temperature: temperature,
                        max_tokens: maxTokens,
                        ollamaBaseUrl: 'http://localhost:11434'
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to generate script with Ollama');
                }

                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Error generating script with Ollama:', error);
                showStatus(`Error generating script: ${error.message}`, 'error');
                throw error;
            }
        }

        // Regenerate Script
        function regenerateScript() {
            if (lastGenerationParams) {
                // Update form with last params
                document.getElementById('topic').value = lastGenerationParams.topic;
                document.getElementById('audience').value = lastGenerationParams.audience;
                document.getElementById('tone').value = lastGenerationParams.tone;
                document.getElementById('length').value = lastGenerationParams.length;
                document.getElementById('additional').value = lastGenerationParams.additional;
                document.getElementById('keywords').value = lastGenerationParams.keywords;
                document.getElementById('temperature').value = lastGenerationParams.temperature;
                tempValue.textContent = lastGenerationParams.temperature;
                document.getElementById('max-tokens').value = lastGenerationParams.maxTokens;
                
                // Restore structure selections
                structureItems.forEach(item => {
                    if (lastGenerationParams.activeStructures.includes(item.dataset.structure)) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                generateScript();
            } else {
                showStatus('No previous script to regenerate', 'error');
            }
        }

        // Enable Edit Mode
        function enableEditMode() {
            scriptOutput.contentEditable = true;
            scriptOutput.classList.add('edit-mode');
            scriptOutput.focus();
            showStatus('Script is now editable. Click anywhere else to save changes.', 'info');
            
            // Save changes when focus is lost
            scriptOutput.addEventListener('blur', () => {
                scriptOutput.contentEditable = false;
                scriptOutput.classList.remove('edit-mode');
                updateScriptStats(scriptOutput.textContent);
                showStatus('Changes saved', 'success');
            });
        }

        // Update Script Stats
        function updateScriptStats(script) {
            const wordCount = script.trim().split(/\s+/).length;
            const charCount = script.length;
            const estimatedMinutes = Math.ceil(wordCount / 150); // Average speaking rate
            const tokenCount = Math.ceil(script.length / 4); // Rough token estimation
            
            document.getElementById('word-count').textContent = wordCount;
            document.getElementById('char-count').textContent = charCount;
            document.getElementById('script-length').textContent = estimatedMinutes;
            document.getElementById('token-count').textContent = tokenCount;
        }

        // Fetch Ollama Models
        async function fetchOllamaModels() {
            const ollamaModelsContainer = document.getElementById('ollama-models');
        ollamaModelsContainer.innerHTML = '<div class="model-category"><h4>Ollama Local Models</h4><p>Loading models...</p></div>';

        try {
            const response = await fetch(`http://localhost:3001/api/ollama/tags`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.models && data.models.length > 0) {
                    let modelsHtml = '<div class="model-category"><h4>Ollama Local Models</h4>';
                    data.models.forEach(model => {
                        modelsHtml += `<div class="model-option" data-model="${model.name}">${model.name}</div>`;
                    });
                    modelsHtml += '</div>';
                    ollamaModelsContainer.innerHTML = modelsHtml;
                    // Re-attach event listeners to new model options
                    document.querySelectorAll('#ollama-models .model-option').forEach(option => {
                        option.addEventListener('click', () => {
                            document.querySelectorAll('#ollama-models .model-option').forEach(opt => opt.classList.remove('active'));
                            option.classList.add('active');
                            currentModel = option.dataset.model;
                            showStatus(`Selected Ollama model: ${currentModel}`, 'info');
                        });
                    });

                    // Automatically select the first Ollama model and trigger generation
                    const firstOllamaModel = document.querySelector('#ollama-models .model-option');
                    if (firstOllamaModel) {
                        firstOllamaModel.classList.add('active');
                        currentModel = firstOllamaModel.dataset.model;
                        showStatus(`Automatically selected Ollama model: ${currentModel}`, 'info');
                        // Trigger script generation after a short delay to allow UI to update
                        setTimeout(generateScript, 1000);
                    }
                } else {
                    ollamaModelsContainer.innerHTML = '<div class="model-category"><h4>Ollama Local Models</h4><p>No models found. Make sure Ollama is running and models are pulled.</p></div>';
                }
            } catch (error) {
                console.error('Error fetching Ollama models:', error);
                ollamaModelsContainer.innerHTML = `<div class="model-category"><h4>Ollama Local Models</h4><p>Error loading models: ${error.message}</p></div>`;
                showStatus(`Error fetching Ollama models: ${error.message}`, 'error');
            }
        }

        // Generate with OpenAI API
        async function generateWithOpenAI(topic, audience, tone, length, additional, keywords, temperature, maxTokens, structures, apiKey, model) {
            // Build prompt based on selected structures
            const structureMap = {
                intro: "1. An engaging intro hook to capture attention immediately",
                problem: "2. Clear problem statement identifying the audience's pain points",
                solution: "3. Present your solution with clear explanation",
                benefits: "4. Highlight key benefits and value proposition",
                examples: "5. Provide practical examples or case studies",
                steps: "6. Actionable steps or implementation guide",
                mistakes: "7. Common mistakes to avoid and how to prevent them",
                tools: "8. Recommended tools, resources, or further reading",
                summary: "9. Summary of key points covered",
                cta: "10. Strong call-to-action encouraging engagement",
                faq: "11. Address frequently asked questions",
                visuals: "12. Suggested visuals, graphics, or on-screen text cues"
            };

            const selectedSections = structures.map(struct => structureMap[struct]).join('\n');

            const prompt = `Create a YouTube video script with the following details:
            
Topic: ${topic}
Target Audience: ${audience}
Tone: ${tone}
Video Length: ${length} minutes
SEO Keywords: ${keywords || 'None'}
Additional Instructions: ${additional || 'None'}

Please create a complete YouTube script with:
${selectedSections}

Format the script professionally with clear scene directions and dialogue. Make it engaging and appropriate for the specified tone and audience. Include timing cues for a ${length}-minute video.`;

            const response = await fetch('http://localhost:3001/api/openai/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        {
                            role: "system",
                            content: "You are a professional YouTube script writer. Create engaging, well-structured video scripts with proper timing for the specified video length."
                        },
                        {
                            role: "user",
                            content: prompt
                        }
                    ],
                    temperature: temperature,
                    max_tokens: maxTokens,
                    apiKey: apiKey
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to generate script with OpenAI');
            }

            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        // Generate with Gemini API
        async function generateWithGemini(topic, audience, tone, length, additional, keywords, temperature, maxTokens, structures, apiKey, model) {
            // Build prompt based on selected structures
            const structureMap = {
                intro: "1. An engaging intro hook to capture attention immediately",
                problem: "2. Clear problem statement identifying the audience's pain points",
                solution: "3. Present your solution with clear explanation",
                benefits: "4. Highlight key benefits and value proposition",
                examples: "5. Provide practical examples or case studies",
                steps: "6. Actionable steps or implementation guide",
                mistakes: "7. Common mistakes to avoid and how to prevent them",
                tools: "8. Recommended tools, resources, or further reading",
                summary: "9. Summary of key points covered",
                cta: "10. Strong call-to-action encouraging engagement",
                faq: "11. Address frequently asked questions",
                visuals: "12. Suggested visuals, graphics, or on-screen text cues"
            };

            const selectedSections = structures.map(struct => structureMap[struct]).join('\n');

            const prompt = `Create a YouTube video script with the following details:
            
Topic: ${topic}
Target Audience: ${audience}
Tone: ${tone}
Video Length: ${length} minutes
SEO Keywords: ${keywords || 'None'}
Additional Instructions: ${additional || 'None'}

Please create a complete YouTube script with:
${selectedSections}

Format the script professionally with clear scene directions and dialogue. Make it engaging and appropriate for the specified tone and audience. Include timing cues for a ${length}-minute video.`;

            const response = await fetch('http://localhost:3001/api/gemini/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: model,
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    temperature: temperature,
                    max_tokens: maxTokens,
                    apiKey: apiKey
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to generate script with Gemini');
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text.trim();
        }

        // Copy Script to Clipboard
        function copyScript() {
            const text = scriptOutput.textContent;
            if (text && text !== 'Your generated script will appear here...') {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showStatus('Script copied to clipboard!', 'success');
                    })
                    .catch(() => {
                        showStatus('Failed to copy script', 'error');
                    });
            } else {
                showStatus('No script to copy', 'error');
            }
        }

        // Download Script
        function downloadScript(format) {
            const text = scriptOutput.textContent;
            if (text && text !== 'Your generated script will appear here...') {
                let blob, mimeType, extension, filename;
                
                const timestamp = new Date().toISOString().slice(0, 10);
                const topic = document.getElementById('topic').value || 'youtube-script';
                filename = `${topic.replace(/\s+/g, '-').toLowerCase()}-${timestamp}`;
                
                switch(format) {
                    case 'txt':
                        blob = new Blob([text], { type: 'text/plain' });
                        extension = 'txt';
                        break;
                    case 'doc':
                        // Create a simple DOC format
                        const docContent = `YouTube Script: ${document.getElementById('topic').value || 'Untitled'}\n\n` +
                                         `Generated on: ${new Date().toLocaleString()}\n\n` +
                                         text;
                        blob = new Blob([docContent], { type: 'application/msword' });
                        extension = 'doc';
                        break;
                    case 'pdf':
                        downloadPDF();
                        return;
                }
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}.${extension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showStatus(`Script downloaded as ${extension.toUpperCase()}!`, 'success');
            } else {
                showStatus('No script to download', 'error');
            }
        }

        // Download PDF using jsPDF
        async function downloadPDF() {
            try {
                showStatus('Generating PDF...', 'loading');
                
                // Get the jsPDF instance
                const { jsPDF } = window.jspdf;
                
                // Create new PDF
                const doc = new jsPDF();
                
                // Get script content
                const text = scriptOutput.textContent;
                const topic = document.getElementById('topic').value || 'YouTube Script';
                
                // Add title
                doc.setFontSize(18);
                doc.text(topic, 20, 20);
                
                // Add generation date
                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text(`Generated on: ${new Date().toLocaleString()}`, 20, 30);
                
                // Reset text color
                doc.setTextColor(0);
                
                // Add content with automatic line wrapping
                doc.setFontSize(11);
                const splitText = doc.splitTextToSize(text, 170);
                doc.text(splitText, 20, 45);
                
                // Save the PDF
                const timestamp = new Date().toISOString().slice(0, 10);
                const filename = `${topic.replace(/\s+/g, '-').toLowerCase()}-${timestamp}.pdf`;
                doc.save(filename);
                
                showStatus('PDF downloaded successfully!', 'success');
            } catch (error) {
                console.error('PDF generation error:', error);
                showStatus('Failed to generate PDF', 'error');
            }
        }

        // Save Current Script to History
        function saveCurrentScript() {
            const script = scriptOutput.textContent;
            if (script && script !== 'Your generated script will appear here...') {
                const history = JSON.parse(localStorage.getItem(HISTORY_STORAGE) || '[]');
                
                const newEntry = {
                    id: Date.now(),
                    topic: document.getElementById('topic').value,
                    audience: document.getElementById('audience').value,
                    tone: document.getElementById('tone').value,
                    length: document.getElementById('length').value,
                    additional: document.getElementById('additional').value,
                    script: script,
                    api: currentAPI,
                    model: currentModel,
                    timestamp: new Date().toISOString()
                };
                
                history.push(newEntry);
                localStorage.setItem(HISTORY_STORAGE, JSON.stringify(history));
                
                loadHistory();
                showStatus('Script saved to history!', 'success');
            } else {
                showStatus('No script to save', 'error');
            }
        }

        // Clear History
        function clearHistory() {
            if (confirm('Are you sure you want to clear all script history? This cannot be undone.')) {
                localStorage.removeItem(HISTORY_STORAGE);
                loadHistory();
                showStatus('History cleared', 'success');
            }
        }

        // Show Status Message
        function showStatus(message, type) {
            statusEl.textContent = message;
            statusEl.className = 'status show ' + type;
            
            // Auto-hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.classList.remove('show');
                }, 3000);
            }
        }
    </script>
</body>
</html>